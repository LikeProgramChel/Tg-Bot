
<!DOCTYPE html>
<html>
<head>
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { margin-right: 5px; }
        canvas { max-width: 600px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º</h1>
    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ current_user }} | <a href="{{ url_for('admin_dashboard') }}">–û–±–Ω–æ–≤–∏—Ç—å</a> | <a href="{{ url_for('test_users') }}">–¢–µ—Å—Ç–∏—Ä–æ–≤–∫–∞</a></p>

    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <canvas id="statsChart"></canvas>
    <ul>
        <li>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ stats.total_users }}</li>
        <li>–° —Ñ–æ—Ç–æ: {{ stats.profiles_with_photo }}</li>
        <li>–ê–∫—Ç–∏–≤–Ω—ã—Ö: {{ stats.active_profiles }}</li>
    </ul>

    <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
    <table>
        <tr>
            <th>ID</th><th>–ò–º—è</th><th>–í–æ–∑—Ä–∞—Å—Ç</th><th>–ü–æ–ª</th><th>–§–æ—Ç–æ</th><th>–õ–∞–π–∫–∏</th><th>–î–∏–∑–ª–∞–π–∫–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞</th><th>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        {% for user_id, user in users.items() %}
        <tr>
            <td>{{ user_id }}</td>
            <td>{{ user.name }}</td>
            <td>{{ user.age }}</td>
            <td>{{ user.gender }}</td>
            <td>{% if user.photo_id %}‚úÖ –ï—Å—Ç—å{% else %}‚ùå –ù–µ—Ç{% endif %}</td>
            <td>{{ user.likes|length }}</td>
            <td>{{ user.dislikes|length }}</td>
            <td>{{ user.state }}</td>
            <td>{{ op_status }}</td>
            <td>{{ 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' if user.is_blocked else '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' }}</td>
            <td>{{ 'ü§ñ –î–∞' if user.is_virtual else 'üë§ –ù–µ—Ç' }}</td>
            <td>
                <a href="{{ url_for('view_user', user_id=user_id) }}">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                <form action="{{ url_for('toggle_block_user') }}" method="post" style="display:inline;">
                    {{ block_form.csrf_token }}
                    {{ block_form.user_id(value=user_id) }}
                    <button type="submit">{{ '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' if user.is_blocked else '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' }}</button>
                </form>
                <form action="{{ url_for('delete_user') }}" method="post" style="display:inline;">
                    {{ delete_form.csrf_token }}
                    {{ delete_form.user_id(value=user_id) }}
                    <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('statsChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', '–° —Ñ–æ—Ç–æ', '–ê–∫—Ç–∏–≤–Ω—ã—Ö'],
                datasets: [{
                    label: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                    data: [{{ stats.total_users }}, {{ stats.profiles_with_photo }}, {{ stats.active_profiles }}],
                    backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'],
                    borderColor: ['#36A2EB', '#FF6384', '#FFCE56'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>
</body>
</html>
